<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fee Reserve Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      @page { margin: 1cm; size: auto; }
      body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .print-hidden { display: none !important; }
      .print-block { display: block !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 font-sans p-4 md:p-8 print:bg-white print:p-0">
  <div class="max-w-6xl mx-auto">

    <!-- Header (Screen Only) -->
    <header class="mb-8 print-hidden border-b pb-4 flex justify-between items-end">
      <div>
        <h1 class="text-3xl font-bold text-slate-800 flex items-center gap-2">
          <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <rect x="4" y="2" width="16" height="20" rx="2"></rect>
            <line x1="8" y1="6" x2="16" y2="6"></line>
            <line x1="8" y1="10" x2="8" y2="10.01"></line>
            <line x1="12" y1="10" x2="12" y2="10.01"></line>
            <line x1="16" y1="10" x2="16" y2="10.01"></line>
            <line x1="8" y1="14" x2="8" y2="14.01"></line>
            <line x1="12" y1="14" x2="12" y2="14.01"></line>
            <line x1="16" y1="14" x2="16" y2="14.01"></line>
            <line x1="8" y1="18" x2="8" y2="18.01"></line>
            <line x1="12" y1="18" x2="16" y2="18"></line>
          </svg>
          Fee Reserve Calculator
        </h1>
        <p class="text-gray-500 mt-2">
          Determine the upfront deposit required for advisory fees on non-custodied private investments.
        </p>
      </div>
      <button onclick="window.print()" class="hidden md:flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-sm font-medium transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <polyline points="6 9 6 2 18 2 18 9"></polyline>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
          <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        Print Report
      </button>
    </header>

    <!-- Header (Print Only) -->
    <div class="hidden print-block mb-8 border-b-2 border-slate-800 pb-4">
      <h1 class="text-2xl font-bold text-slate-800">Fee Reserve Authorization Estimate</h1>
      <div class="mt-4 text-sm text-gray-700 leading-relaxed text-justify">
        <strong>Purpose of Calculation:</strong> The Private Investment selected below is held directly with the issuer and is not maintained within our standard custody accounts. Consequently, advisory fees cannot be deducted directly from the investment balance. This calculation estimates the total advisory fees attributable to this specific investment over the projected term. The "Total Deposit Required" represents the amount to be pre-funded into the Client's designated fee reserve account to cover these obligations.
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- LEFT COLUMN: Inputs -->
      <div class="lg:col-span-1 space-y-6 print-hidden">

        <!-- Client Details Card -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <h2 class="text-lg font-semibold mb-4 text-slate-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Client Details
          </h2>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Client Full Name</label>
              <input type="text" id="clientName" placeholder="e.g. John & Jane Doe" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Investment Selection</label>
              <select id="investmentName" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white">
                <option value="TBC">TBC</option>
                <option value="AQR TA Delphi Plus Fund">AQR TA Delphi Plus Fund</option>
                <option value="Quantinno QFAF">Quantinno QFAF</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Custodian</label>
              <select id="custodian" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white">
                <option value="Schwab">Schwab</option>
                <option value="Fidelity">Fidelity</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Fee Reserve Account #</label>
              <input type="text" id="accountNumber" placeholder="(If established)" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
          </div>
        </div>

        <!-- Financial Params Card -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
          <h2 class="text-lg font-semibold mb-4 text-slate-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Financials
          </h2>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Private Investment Amount</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="text-gray-400">$</span>
              </div>
              <input type="number" id="privateAUM" value="1000000" class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Additional Household AUM</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="text-gray-400">$</span>
              </div>
              <input type="number" id="householdAUM" value="500000" class="block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
            <p class="text-xs text-gray-500 mt-1">Other assets used for tier blending.</p>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Term (Years)</label>
              <input type="number" id="term" value="5" min="1" step="1" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-1">Annual Growth %</label>
              <input type="number" id="growthRate" value="5.0" step="0.1" class="block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
          </div>

          <div class="pt-4 border-t flex justify-between items-center">
            <button onclick="toggleFeeSchedule()" class="text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              <span id="feeScheduleToggleText">View Fee Schedule</span>
            </button>

            <button onclick="resetForm()" class="text-sm text-gray-500 hover:text-red-600 flex items-center gap-1 transition-colors">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
              </svg>
              Reset
            </button>
          </div>

          <div id="feeSchedulePanel" class="hidden mt-4 bg-blue-50 p-3 rounded text-xs text-blue-800 space-y-1">
            <p class="font-semibold mb-2">Marginal Rate Schedule:</p>
            <div class="flex justify-between"><span>First $500k</span><span class="font-mono">1.25%</span></div>
            <div class="flex justify-between"><span>Next $1.25M ($500k - $1.75M)</span><span class="font-mono">1.00%</span></div>
            <div class="flex justify-between"><span>Next $3.25M ($1.75M - $5M)</span><span class="font-mono">0.75%</span></div>
            <div class="flex justify-between"><span>$5M+</span><span class="font-mono">0.50%</span></div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Output -->
      <div class="lg:col-span-2 space-y-6">

        <!-- Print View Info Block -->
        <div class="hidden print-block mb-6 bg-gray-50 p-4 rounded border border-gray-200">
          <div class="grid grid-cols-2 gap-y-4 gap-x-8 text-sm">
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Client Name</span>
              <span id="printClientName" class="font-semibold text-lg">—</span>
            </div>
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Private Investment</span>
              <span id="printInvestmentName" class="font-semibold text-lg">TBC</span>
            </div>
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Fee Reserve Account</span>
              <span id="printAccount" class="font-medium">Schwab</span>
            </div>
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Investment Amount</span>
              <span id="printPrivateAUM" class="font-medium">$1,000,000</span>
            </div>
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Additional AUM</span>
              <span id="printHouseholdAUM" class="font-medium">$500,000</span>
            </div>
            <div>
              <span class="text-gray-500 block text-xs uppercase tracking-wider">Assumption: Annual Growth</span>
              <span id="printGrowthRate" class="font-medium">5%</span>
            </div>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-blue-600 text-white p-6 rounded-xl shadow-md col-span-1 md:col-span-3 lg:col-span-1 print:bg-white print:text-black print:border-2 print:border-slate-800 print:shadow-none">
            <h3 class="text-blue-100 text-sm font-medium uppercase tracking-wider print:text-slate-600">Total Deposit Required</h3>
            <div id="totalFeeReserve" class="text-3xl font-bold mt-2">$0</div>
            <div class="text-blue-200 text-xs mt-1 print:text-slate-500">
              Total Projected Fees over <span id="termDisplay">5</span> Years
            </div>
          </div>

          <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 print:border-gray-300">
            <h3 class="text-gray-500 text-sm font-medium uppercase tracking-wider">Effective Annual Rate</h3>
            <div id="yearOneBlendedRate" class="text-2xl font-bold mt-2 text-slate-700">0.00%</div>
            <div class="text-gray-400 text-xs mt-1">Blended rate (Year 1)</div>
          </div>

          <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 print:border-gray-300">
            <h3 class="text-gray-500 text-sm font-medium uppercase tracking-wider">Cost of Capital</h3>
            <div id="feeAsPercentage" class="text-2xl font-bold mt-2 text-slate-700">0.00%</div>
            <div class="text-gray-400 text-xs mt-1">Total fees / Initial Investment</div>
          </div>
        </div>

        <!-- Detailed Table -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print:shadow-none print:border">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 print:bg-gray-100">
            <h3 class="font-semibold text-gray-800">Fee Schedule Projection</h3>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50 print:bg-white">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total Household AUM</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Blended Rate</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell print-hidden">Total Fee</th>
                  <th class="px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider bg-blue-50 print:bg-white">Private Inv. Fee</th>
                </tr>
              </thead>
              <tbody id="scheduleBody" class="bg-white divide-y divide-gray-200">
              </tbody>
            </table>
          </div>
        </div>

        <!-- Signature Block (Print Only) -->
        <div class="hidden print-block mt-16 pt-8 border-t border-gray-300">
          <div class="grid grid-cols-2 gap-16">
            <div>
              <div class="h-16 border-b border-black"></div>
              <div class="flex justify-between mt-2 text-sm text-gray-600">
                <span>Client Signature</span>
                <span>Date</span>
              </div>
            </div>
            <div>
              <div class="h-16 border-b border-black"></div>
              <div class="flex justify-between mt-2 text-sm text-gray-600">
                <span>Advisor Signature</span>
                <span>Date</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer class="mt-12 text-center text-xs text-gray-400 print-hidden">
      <p>For illustrative purposes only. Actual fees may vary based on contract specifics and market performance.</p>
    </footer>
  </div>

  <script>
    // Fee tiers
    const TIERS = [
      { limit: 500000, rate: 0.0125 },
      { limit: 1750000, rate: 0.0100 },
      { limit: 5000000, rate: 0.0075 },
      { limit: Infinity, rate: 0.0050 },
    ];

    // Format helpers
    function formatCurrency(val) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      }).format(val);
    }

    function formatPercent(val) {
      return new Intl.NumberFormat('en-US', {
        style: 'percent',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }).format(val);
    }

    // Calculate blended fee based on tiered schedule
    function calculateBlendedFee(totalAum) {
      let remainingAum = totalAum;
      let totalFee = 0;
      let previousTierLimit = 0;

      for (let i = 0; i < TIERS.length; i++) {
        const tier = TIERS[i];
        const tierCap = tier.limit;
        const amountInTier = Math.min(Math.max(0, remainingAum), tierCap - previousTierLimit);

        totalFee += amountInTier * tier.rate;

        remainingAum -= amountInTier;
        previousTierLimit = tierCap;

        if (remainingAum <= 0) break;
      }
      return totalFee;
    }

    // Main calculation
    function calculate() {
      const privateAUM = parseFloat(document.getElementById('privateAUM').value) || 0;
      const householdAUM = parseFloat(document.getElementById('householdAUM').value) || 0;
      const term = Math.max(1, Math.round(parseFloat(document.getElementById('term').value) || 5));
      const growthRate = (parseFloat(document.getElementById('growthRate').value) || 0) / 100;

      let currentPrivateAUM = privateAUM;
      let currentHouseholdAUM = householdAUM;
      let totalReserve = 0;
      let yearOneBlendedRate = 0;
      const schedule = [];

      for (let year = 1; year <= term; year++) {
        const totalAUM = currentPrivateAUM + currentHouseholdAUM;
        const totalFee = calculateBlendedFee(totalAUM);
        const blendedRate = totalAUM > 0 ? totalFee / totalAUM : 0;

        if (year === 1) {
          yearOneBlendedRate = blendedRate;
        }

        const allocationRatio = totalAUM > 0 ? currentPrivateAUM / totalAUM : 0;
        const privateFee = totalFee * allocationRatio;

        schedule.push({ year, totalAUM, blendedRate, totalFee, privateFee });
        totalReserve += privateFee;

        currentPrivateAUM *= (1 + growthRate);
        currentHouseholdAUM *= (1 + growthRate);
      }

      // Update display
      document.getElementById('totalFeeReserve').textContent = formatCurrency(totalReserve);
      document.getElementById('yearOneBlendedRate').textContent = formatPercent(yearOneBlendedRate);
      document.getElementById('feeAsPercentage').textContent = formatPercent(privateAUM > 0 ? totalReserve / privateAUM : 0);
      document.getElementById('termDisplay').textContent = term;

      // Update print fields
      document.getElementById('printClientName').textContent = document.getElementById('clientName').value || '—';
      document.getElementById('printInvestmentName').textContent = document.getElementById('investmentName').value;
      document.getElementById('printAccount').textContent = document.getElementById('custodian').value +
        (document.getElementById('accountNumber').value ? ' — #' + document.getElementById('accountNumber').value : '');
      document.getElementById('printPrivateAUM').textContent = formatCurrency(privateAUM);
      document.getElementById('printHouseholdAUM').textContent = formatCurrency(householdAUM);
      document.getElementById('printGrowthRate').textContent = document.getElementById('growthRate').value + '%';

      // Build table
      const tbody = document.getElementById('scheduleBody');
      tbody.innerHTML = '';

      schedule.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 transition-colors';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.year}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">${formatCurrency(row.totalAUM)}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right hidden sm:table-cell">${formatPercent(row.blendedRate)}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right hidden sm:table-cell print-hidden">${formatCurrency(row.totalFee)}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-blue-600 text-right bg-blue-50 print:bg-white print:text-black">${formatCurrency(row.privateFee)}</td>
        `;
        tbody.appendChild(tr);
      });

      // Total row
      const totalRow = document.createElement('tr');
      totalRow.className = 'bg-gray-100 font-semibold print:bg-gray-50';
      totalRow.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Total</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500">—</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 hidden sm:table-cell">—</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 hidden sm:table-cell print-hidden">—</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-blue-700 bg-blue-100 border-t-2 border-blue-200 print:bg-white print:border-t print:text-black">${formatCurrency(totalReserve)}</td>
      `;
      tbody.appendChild(totalRow);
    }

    function toggleFeeSchedule() {
      const panel = document.getElementById('feeSchedulePanel');
      const text = document.getElementById('feeScheduleToggleText');
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        text.textContent = 'Hide Fee Schedule';
      } else {
        panel.classList.add('hidden');
        text.textContent = 'View Fee Schedule';
      }
    }

    function resetForm() {
      document.getElementById('privateAUM').value = 1000000;
      document.getElementById('householdAUM').value = 500000;
      document.getElementById('term').value = 5;
      document.getElementById('growthRate').value = 5.0;
      document.getElementById('clientName').value = '';
      document.getElementById('investmentName').value = 'TBC';
      document.getElementById('custodian').value = 'Schwab';
      document.getElementById('accountNumber').value = '';
      calculate();
    }

    // Add event listeners
    document.querySelectorAll('input, select').forEach(el => {
      el.addEventListener('input', calculate);
      el.addEventListener('change', calculate);
    });

    // Initial calculation
    calculate();
  </script>
</body>
</html>
